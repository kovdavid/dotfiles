#!/bin/bash

ACTION=$1

function menu_item {
    INFO=$1
    NAME=$2
    ICON=$3

    echo -en "$NAME\x00info\x1f$INFO"

    if [ -n $ICON ] ; then
        echo -en "\x1ficon\x1f$ICON"
    fi

    echo -en "\n"
}

function run_cmd {
    CMD=$1

    coproc ( $CMD  > /dev/null 2>&1 )
}

if [ "$ACTION" == "quit" ] ; then
    exit 0
fi

if [ -z "$ROFI_INFO" ] ; then
    menu_item "main" "terminal" "utilities-terminal"
    menu_item "main" "firefox" "firefox"
    menu_item "main" "thunar" "folder"
    menu_item "main" "gimp" "image-png"
    menu_item "main" "pavucontrol" "player-volume"
    menu_item "main" "i3 rename workspace" "edit-rename"
    menu_item "main" "scrot" "camera-photo"
    menu_item "main" "power" "preferences-system-power-management"
    menu_item "main" "display" "preferences-desktop-display"
    menu_item "main" "quit" "application-exit"
elif [ "$ROFI_INFO" == "main" ] ; then
    if [ "$ACTION" == "power" ] ; then
        menu_item "main power" "sleep+lock" "system-switch-user"
        menu_item "main power" "sleep" "system-suspend"
        menu_item "main power" "lock" "system-lock-screen"
        menu_item "main power" "halt" "system-shutdown"
        menu_item "main power" "reboot" "system-reboot"
    elif [ "$ACTION" == "display" ] ; then
        menu_item "main display" "external monitor left" "arrow-left"
        menu_item "main display" "mexternal onitor right" "arrow-right"
        menu_item "main display" "notebook only" "computer-laptop"
        menu_item "main display" "external monitor only" "video-display"
    fi
elif [ "$ROFI_INFO" == "main display" ] ; then
    if [ "$ACTION" == "monitor left" ] ; then
        run_cmd "mon left"
    elif [ "$ACTION" == "monitor right" ] ; then
        run_cmd "mon right"
    elif [ "$ACTION" == "notebook only" ] ; then
        run_cmd "mon off"
    elif [ "$ACTION" == "external monitor only" ] ; then
        run_cmd "mon sec"
    fi
elif [ "$ROFI_INFO" == "main power" ] ; then
    if [ "$ACTION" == "sleep+lock" ] ; then
        run_cmd "i3lock -c 333333; systemctl suspend"
    elif [ "$ACTION" == "sleep" ] ; then
        run_cmd "systemctl suspend"
    elif [ "$ACTION" == "lock" ] ; then
        run_cmd "i3lock -c 333333"
    elif [ "$ACTION" == "halt" ] ; then
        run_cmd "systemctl poweroff"
    elif [ "$ACTION" == "reboot" ] ; then
        run_cmd "systemctl reboot"
    fi
fi
